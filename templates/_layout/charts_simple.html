<!-- Macros simplifi√©es pour les graphiques Plotly -->

<!-- Macro pour graphique en ligne -->
{% macro line_chart(chart_id, data, title="") %}
<div class="bg-gray-900 rounded-2xl shadow-lg p-6">
    {% if title %}
    <h3 class="text-lg font-semibold text-white mb-4">{{ title }}</h3>
    {% endif %}
    <div id="{{ chart_id }}" style="height: 400px;"></div>
</div>

<script>
(function() {
    const data = {{ data|tojson }};
    const traces = data.map((series, index) => ({
        x: series.x,
        y: series.y,
        type: 'scatter',
        mode: 'lines+markers',
        name: series.name,
        line: {
            color: ['#38bdf8', '#22c55e', '#f59e0b', '#ef4444', '#8b5cf6'][index % 5],
            width: 3
        },
        marker: {
            size: 6,
            color: ['#38bdf8', '#22c55e', '#f59e0b', '#ef4444', '#8b5cf6'][index % 5]
        }
    }));
    
    const layout = {
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(0,0,0,0)',
        font: { color: '#e5e7eb' },
        margin: { t: 40, r: 20, b: 40, l: 40 },
        xaxis: { gridcolor: '#374151', linecolor: '#4b5563' },
        yaxis: { gridcolor: '#374151', linecolor: '#4b5563' },
        showlegend: true,
        legend: { bgcolor: 'rgba(0,0,0,0)', font: { color: '#e5e7eb' } }
    };
    
    Plotly.newPlot('{{ chart_id }}', traces, layout, { displayModeBar: false, responsive: true });
})();
</script>
{% endmacro %}

<!-- Macro pour graphique en barres -->
{% macro bar_chart(chart_id, data, title="", orientation="v") %}
<div class="bg-gray-900 rounded-2xl shadow-lg p-6">
    {% if title %}
    <h3 class="text-lg font-semibold text-white mb-4">{{ title }}</h3>
    {% endif %}
    <div id="{{ chart_id }}" style="height: 500px;"></div> <!-- üÜï hauteur augment√©e -->
</div>

<script>
(function() {
    const data = {{ data|tojson }};
    
    const trace = {
        {% if orientation == 'h' %}
        y: data.labels,
        x: data.values,
        orientation: 'h',
        {% else %}
        x: data.labels,
        y: data.values,
        {% endif %}
        type: 'bar',
        marker: {
            color: data.colors || '#38bdf8'
        },
        text: data.values.map(v => v.toString()),
        textposition: 'auto',
        hoverinfo: 'x+y', // simplifi√©
    };
    
    const layout = {
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(0,0,0,0)',
        font: { color: '#e5e7eb' },
        // üÜï plus d'espace √† gauche si orientation horizontale
        margin: { t: 40, r: 30, b: 40, l: {% if orientation == 'h' %}240{% else %}40{% endif %} },
        xaxis: { gridcolor: '#374151', linecolor: '#4b5563' },
        yaxis: {
            gridcolor: '#374151',
            linecolor: '#4b5563',
            automargin: true, // üÜï texte long visible
        }
    };
    
    Plotly.newPlot('{{ chart_id }}', [trace], layout, { displayModeBar: false, responsive: true });
})();
</script>
{% endmacro %}


{% macro pie_chart(chart_id, data, title="") %}
<div class="bg-gray-900 rounded-2xl shadow-lg p-6">
    {% if title %}
    <h3 class="text-lg font-semibold text-white mb-4">{{ title }}</h3>
    {% endif %}
    <div id="{{ chart_id }}" style="height: 400px;"></div>
</div>

<script>
(function() {
    const data = {{ data|tojson }};
    
    const trace = {
        labels: data.labels,
        values: data.values,
        type: 'pie',
        marker: {
            colors: data.colors || ['#38bdf8', '#22c55e', '#f59e0b', '#ef4444', '#8b5cf6']
        },
        // ‚ùå Supprimer le texte dans les parts
        textinfo: 'none',
        hoverinfo: 'label+percent', // affich√© uniquement au survol
    };
    
    const layout = {
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(0,0,0,0)',
        font: { color: '#e5e7eb' },
        margin: { t: 40, r: 20, b: 40, l: 40 },
        showlegend: true,
        legend: {
            bgcolor: 'rgba(0,0,0,0)',
            font: { color: '#e5e7eb', size: 12 },
            orientation: 'v',
        }
    };
    
    Plotly.newPlot('{{ chart_id }}', [trace], layout, { displayModeBar: false, responsive: true });
})();
</script>
{% endmacro %}


<!-- Macro pour graphique donut (comme pie mais avec un trou au centre) -->
{% macro donut_chart(chart_id, data, title="") %}
<div class="bg-gray-900 rounded-2xl shadow-lg p-6">
    {% if title %}
    <h3 class="text-lg font-semibold text-white mb-4">{{ title }}</h3>
    {% endif %}
    <div id="{{ chart_id }}" style="height: 400px;"></div>
</div>

<script>
(function() {
    const data = {{ data|tojson }};
    
    const trace = {
        labels: data.labels,
        values: data.values,
        type: 'pie',
        hole: 0.4,  // ‚úÖ C'est ce param√®tre qui cr√©e le donut (trou de 40%)
        marker: {
            colors: data.colors || ['#38bdf8', '#22c55e', '#f59e0b', '#ef4444', '#8b5cf6']
        },
        textinfo: 'none',
        hoverinfo: 'label+percent',
    };
    
    const layout = {
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(0,0,0,0)',
        font: { color: '#e5e7eb' },
        margin: { t: 40, r: 20, b: 40, l: 40 },
        showlegend: true,
        legend: {
            bgcolor: 'rgba(0,0,0,0)',
            font: { color: '#e5e7eb', size: 12 },
            orientation: 'v',
        }
    };
    
    Plotly.newPlot('{{ chart_id }}', [trace], layout, { displayModeBar: false, responsive: true });
})();
</script>
{% endmacro %}

<!-- Macro pour graphique scatter -->
{% macro scatter_chart(chart_id, data, title="", x_title="", y_title="") %}
<div class="bg-gray-900 rounded-2xl shadow-lg p-6">
    {% if title %}
    <h3 class="text-lg font-semibold text-white mb-4">{{ title }}</h3>
    {% endif %}
    <div id="{{ chart_id }}" style="height: 400px;"></div>
</div>

<script>
(function() {
    const data = {{ data|tojson }};
    
    const trace = {
        x: data.x,
        y: data.y,
        mode: 'markers',
        type: 'scatter',
        marker: {
            size: data.sizes || 8,
            color: data.colors || '#38bdf8',
            opacity: 0.7
        },
        text: data.labels || []
    };
    
    const layout = {
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(0,0,0,0)',
        font: { color: '#e5e7eb' },
        margin: { t: 40, r: 20, b: 40, l: 40 },
        xaxis: { 
            gridcolor: '#374151', 
            linecolor: '#4b5563',
            title: { text: '{{ x_title }}', font: { color: '#e5e7eb' } }
        },
        yaxis: { 
            gridcolor: '#374151', 
            linecolor: '#4b5563',
            title: { text: '{{ y_title }}', font: { color: '#e5e7eb' } }
        }
    };
    
    Plotly.newPlot('{{ chart_id }}', [trace], layout, { displayModeBar: false, responsive: true });
})();
</script>
{% endmacro %}
