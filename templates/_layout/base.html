<!DOCTYPE html>
<html lang="fr" class="dark">

<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}LinkGuardian - Suivi de Netlinking{% endblock %}</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#38bdf8',
                        accent: '#22c55e',
                        warn: '#f59e0b',
                        danger: '#ef4444'
                    }
                }
            }
        }
    </script>
    
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    
    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    
    <!-- Themes CSS -->
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="/static/css/themes.css">
    
    
    <!-- Custom CSS -->
    <style>
        .transition-all { transition: all 150ms ease-in-out; }
        .card-hover:hover { transform: translateY(-2px); }
        .sidebar-link.active { @apply bg-primary/20 border-r-2 border-primary text-primary; }
        .badge { @apply rounded-full px-2 py-0.5 text-xs font-medium; }
        .badge-success { @apply bg-accent/20 text-accent; }
        .badge-warning { @apply bg-warn/20 text-warn; }
        .badge-danger { @apply bg-danger/20 text-danger; }
        .badge-info { @apply bg-primary/20 text-primary; }
        .btn-primary { @apply bg-primary hover:bg-primary/90 text-white rounded-xl px-4 py-2 font-medium transition-all; }
        .btn-secondary { @apply bg-gray-700 hover:bg-gray-600 text-gray-200 rounded-xl px-4 py-2 font-medium transition-all; }
        
        /* Thème clair - Classes adaptatives */
        [data-theme="light"] .bg-gray-900 { @apply bg-white border-gray-200; }
        [data-theme="light"] .bg-gray-800 { @apply bg-gray-50; }
        [data-theme="light"] .bg-gray-700 { @apply bg-gray-100; }
        [data-theme="light"] .text-white { @apply text-gray-900; }
        [data-theme="light"] .text-gray-400 { @apply text-gray-600; }
        [data-theme="light"] .text-gray-300 { @apply text-gray-700; }
        [data-theme="light"] .text-gray-200 { @apply text-gray-800; }
        [data-theme="light"] .border-gray-700 { @apply border-gray-200; }
        [data-theme="light"] .border-gray-600 { @apply border-gray-300; }
        [data-theme="light"] .hover\\:bg-gray-800:hover { @apply bg-gray-100; }
        [data-theme="light"] .hover\\:bg-gray-700:hover { @apply bg-gray-200; }
        [data-theme="light"] .hover\\:bg-gray-600:hover { @apply bg-gray-300; }
        [data-theme="light"] .hover\\:text-white:hover { @apply text-gray-900; }
        [data-theme="light"] .btn-secondary { @apply bg-gray-200 hover:bg-gray-300 text-gray-700; }

        /* Désactiver la sélection de texte sur double-clic */
        .bg-gray-900.rounded-2xl {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        /* Ou plus spécifiquement sur le tableau */
        #backlinks-table table {
            user-select: none;
        }
    </style>
</head>
<body class="min-h-screen transition-colors overflow-x-hidden" 
      x-data="{ 
        sidebarOpen: false, 
        darkMode: JSON.parse(localStorage.getItem('darkMode') ?? 'true'),
        init() {
          this.$watch('darkMode', value => localStorage.setItem('darkMode', JSON.stringify(value)));
        }
      }" 
      :data-theme="darkMode ? 'dark' : 'light'"
      :class="darkMode ? 'bg-slate-900 text-gray-200' : 'bg-gray-50 text-gray-900'"
      x-init="init()">
    
    <!-- Navigation Top Bar -->
    <nav class="bg-gray-900 border-b border-gray-700 px-4 py-3 fixed top-0 left-0 right-0 z-50">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <!-- Sidebar Toggle -->
                {% if current_user.is_authenticated %}
                <button @click="sidebarOpen = !sidebarOpen" class="text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
                {% endif %}
                <!-- Logo -->
                <div class="flex items-center space-x-2">
                    <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" class="w-8 h-8">
                    <h1 class="text-xl font-bold text-white">LinkGuardian</h1>
                </div>
            </div>
            
            <!-- Top Actions -->
            <div class="flex items-center space-x-4">

            {% if not current_user.is_authenticated %}
            <!-- Theme Toggle -->
                <!--
                <button @click="darkMode = !darkMode" class="text-gray-400 hover:text-white transition-colors">
                    <svg x-show="!darkMode" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/>
                    </svg>
                    <svg x-show="darkMode" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"/>
                    </svg>
                </button>
                -->
                <!-- Non connecté: afficher boutons Connexion / Inscription -->
                <a href="/login" class="px-4 py-2 rounded-xl border border-gray-600 text-gray-200 hover:bg-gray-800 transition">
                Connexion
                </a>
                <a href="/signup" class="px-4 py-2 rounded-xl bg-primary text-white hover:bg-primary/90 transition">
                Inscription
                </a>
            {% else %}
                <!-- Notifications -->
                <!--<button class="relative text-gray-400 hover:text-white transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM10.07 2.82l-.908.908a3.87 3.87 0 00-1.13 2.74v2.36a7.91 7.91 0 01-.82 3.74l-.82 1.64a1 1 0 00.9 1.44h9.78a1 1 0 00.9-1.44l-.82-1.64a7.91 7.91 0 01-.82-3.74V6.47a3.87 3.87 0 00-1.13-2.74l-.908-.908a1.94 1.94 0 00-2.74 0z"/>
                    </svg>
                    <span class="absolute -top-1 -right-1 w-3 h-3 bg-danger rounded-full text-xs"></span>
                </button>-->
                
                <!-- Theme Toggle -->
                <!--<button @click="darkMode = !darkMode" class="text-gray-400 hover:text-white transition-colors">
                    <svg x-show="!darkMode" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/>
                    </svg>
                    <svg x-show="darkMode" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"/>
                    </svg>
                </button>-->

                <!-- User Menu -->
                <div class="relative" x-data="{ open: false }">

                    <button @click="open = !open" 
                            class="flex items-center space-x-3 text-gray-400 hover:text-white transition-colors">
                        <div class="w-8 h-8 bg-gray-700 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <span>{{ current_user.first_name }} {{ current_user.last_name }}</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </button>
                    
                    <!-- Dropdown -->
                    <div x-show="open" @click.away="open = false" x-transition class="absolute right-0 mt-2 w-48 bg-gray-800 rounded-xl shadow-lg py-2 z-50">
                        {% if current_user.role == "admin"  %}
                        <a href="/configuration?tab=admin" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white transition-colors">Adminitrateur</a>
                        {% endif %}
                        <a href="/configuration" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white transition-colors">Configuration</a>
                        <a href="/logout" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white transition-colors">Déconnexion</a>
                    </div>
                </div>
            {% endif %}
            
        </div>
    </nav>
    
    {% if current_user.is_authenticated %}
    <!-- Sidebar flottante -->
    <aside 
        class="fixed left-0 top-16 bottom-0 w-64 bg-gray-900 border-r border-gray-700 z-50 transform transition-transform duration-300 ease-in-out"
        :class="{ '-translate-x-full': !sidebarOpen, 'translate-x-0': sidebarOpen }"
    >
        <nav class="p-4 space-y-2">
            <a href="/" class="sidebar-link flex items-center space-x-3 px-3 py-2 rounded-xl text-gray-300 hover:bg-gray-800 hover:text-white transition-all">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
                </svg>
                <span>Dashboard</span>
            </a>

            <a href="/backlinks" class="sidebar-link flex items-center space-x-3 px-3 py-2 rounded-xl text-gray-300 hover:bg-gray-800 hover:text-white transition-all">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z"/>
                </svg>
                <span>Backlinks</span>
                <span class="ml-auto bg-primary/20 text-primary text-xs px-2 py-1 rounded-full">{{ total_backlinks }}</span>
            </a>

            <a href="/domains" class="sidebar-link flex items-center space-x-3 px-3 py-2 rounded-xl text-gray-300 hover:bg-gray-800 hover:text-white transition-all">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/>
                </svg>
                <span>Domaines</span>
                <span class="ml-auto bg-warn/20 text-warn text-xs px-2 py-1 rounded-full">
                    {{ total_unique_domains }}
                </span>
            </a>

            <a href="{{ url_for('sites_routes.shared_data') }}"
            class="flex items-center px-4 py-2 text-gray-300 hover:text-white">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M7 8h10M7 12h6m5-9H6a2 2 0 00-2 2v14l4-4h10a2 2 0 002-2V5a2 2 0 00-2-2z"/>
                </svg>
                Données partagées
            </a>

            <a href="/anchors" class="sidebar-link flex items-center space-x-3 px-3 py-2 rounded-xl text-gray-300 hover:bg-gray-800 hover:text-white transition-all">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                </svg>
                <span>Ancres</span>
                <span class="ml-auto bg-accent/20 text-accent text-xs px-2 py-1 rounded-full">
                    {{ total_unique_anchors }}
                </span>
            </a>

            
            <a href="/configuration" class="sidebar-link flex items-center space-x-3 px-3 py-2 rounded-xl text-gray-300 hover:bg-gray-800 hover:text-white transition-all">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                <span>Configuration</span>
            </a>
        </nav>
    </aside>

    <!-- Fond noir transparent -->
    <div 
        x-show="sidebarOpen"
        @click="sidebarOpen = false"
        class="fixed inset-0 bg-black/50 z-40 transition-opacity duration-300"
        x-transition.opacity
    ></div>
    {% endif %}

    
    <!-- Main Content -->
    <main class="pt-16 min-h-screen transition-all duration-300">
        <div class="p-6">
        {% block content %}{% endblock %}
        </div>
    </main>
    
    <!-- Modal Container -->
    <div id="modal-container" class="fixed inset-0 z-50 hidden">
        <div class="fixed inset-0 bg-black/50" onclick="document.getElementById('modal-container').classList.add('hidden')"></div>
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="bg-gray-900 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
                <div id="modal-content">
                    <!-- Modal content loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- HTMX Config -->
    <script>
        // HTMX configuration
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-refresh elements with data-refresh attribute
            setInterval(function() {
                document.querySelectorAll('[data-refresh]').forEach(function(el) {
                    const interval = parseInt(el.dataset.refresh) * 1000;
                    if (Date.now() - (el.dataset.lastRefresh || 0) > interval) {
                        htmx.trigger(el, 'refresh');
                        el.dataset.lastRefresh = Date.now();
                    }
                });
            }, 5000);
            
            // Modal handling
            document.addEventListener('htmx:afterRequest', function(evt) {
                if (evt.detail.target.id === 'modal-content') {
                    document.getElementById('modal-container').classList.remove('hidden');
                }
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    document.getElementById('modal-container').classList.add('hidden');
                }
            });
        });
    </script>
        <!-- Scripts personnalisés des pages -->
    {% block scripts %}{% endblock %}

</body>
</html>
