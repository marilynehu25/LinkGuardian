{% extends "_layout/base.html" %}
{% from "_layout/components.html" import pagination, quality_meter %}
{% from '_layout/charts_simple.html' import pie_chart, bar_chart, donut_chart %}

{% block title %}Domaines - LinkGuardian{% endblock %}

{% block content %}

<div class="space-y-6">
    <!-- Header -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold text-white">Domaines R√©f√©rents</h1>
            <p class="text-gray-400 mt-1">Analysez vos domaines r√©f√©rents par qualit√©</p>
        </div>
        
        <div class="flex items-center space-x-4">
            <button onclick="window.location.reload()"
                  class="btn-secondary cursor-pointer flex items-center space-x-2">
              üîÑ <span>Actualiser</span>
            </button>
        </div>
    </div>
    
    <!-- Statistiques globales -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <div class="bg-gray-900 rounded-2xl p-6">
            <div class="text-2xl font-bold text-white">{{ total_domains }}</div>
            <div class="text-sm text-gray-400">Domaines totaux</div>
            <div class="text-xs text-accent mt-1"> +{{ domains_this_month }} domaines en plus</div>
        </div>
        
        <div class="bg-gray-900 rounded-2xl p-6">
            <div class="text-2xl font-bold text-accent">{{ avg_quality_current }}/100</div>
            <div class="text-sm text-gray-400">Qualit√© moyenne</div>
            <div class="text-xs text-accent mt-1">+{{ quality_increase }} de qualit√© moyenne</div>
        </div>
        
        <div class="bg-gray-900 rounded-2xl p-6">
            <div class="text-2xl font-bold text-primary">{{ avg_backlinks_per_domain }}</div>
            <div class="text-sm text-gray-400">Backlinks moyen par domaine</div>
        </div>
        
        <div class="bg-gray-900 rounded-2xl p-6">
            <div class="text-2xl font-bold text-warn">{{ premium_domains }}</div>
            <div class="text-sm text-gray-400">Domaines premium</div>
            <div class="text-xs text-gray-400 mt-1">Score > 40</div>
        </div>
    </div>

    <!-- Graphiques -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- R√©partition par qualit√© -->
        {{ donut_chart(
            chart_id='qualityChart',
            data=quality_distribution,
            title='R√©partition par qualit√©'
        ) }}
        
        <!-- Top 10 domaines -->
        {{ bar_chart(
            chart_id='topDomainsChart',
            data=top_domains_chart,
            title='Top 10 domaines',
            orientation='h'
        ) }}
    </div>

    <!-- Table des domaines -->
    <div id="domains-table">
        {% include "domains/_domains_table.html" with context %}
    </div>

</div>

{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


<script>
// Graphique de r√©partition par qualit√©
const qualityCtx = document.getElementById('qualityChart').getContext('2d');
const qualityData = {{ quality_distribution_json|safe }};

new Chart(qualityCtx, {
    type: 'doughnut',
    data: {
        labels: qualityData.labels,
        datasets: [{
            data: qualityData.values,
            backgroundColor: qualityData.colors,
            borderWidth: 0
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    color: '#9ca3af',
                    padding: 15,
                    font: {
                        size: 12
                    }
                }
            }
        }
    }
});

// Graphique Top 10 domaines
const topDomainsCtx = document.getElementById('topDomainsChart').getContext('2d');
const topDomainsData = {{ top_domains_chart_json|safe }};

new Chart(topDomainsCtx, {
    type: 'bar',
    data: {
        labels: topDomainsData.labels,
        datasets: [{
            label: 'Nombre de backlinks',
            data: topDomainsData.values,
            backgroundColor: topDomainsData.colors,
            borderWidth: 0,
            borderRadius: 6
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        indexAxis: 'y',
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            x: {
                grid: {
                    color: '#374151'
                },
                ticks: {
                    color: '#9ca3af'
                }
            },
            y: {
                grid: {
                    display: false
                },
                ticks: {
                    color: '#9ca3af',
                    font: {
                        size: 11
                    }
                }
            }
        }
    }
});
</script>
{% endblock %}